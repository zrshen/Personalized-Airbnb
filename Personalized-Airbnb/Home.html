<!DOCTYPE html>
<html>
<head>
  <title>Persoanlized-Airbnb-Booking-Assistant-Tool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">

  <!-- Load Leaflet code library - see updates at http://leafletjs.com/download.html -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>

  <!-- Load jQuery and PapaParse to read data from a CSV file -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

  <!-- Google fonts -->
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300' rel='stylesheet' type='text/css'>
  <link href='https://fonts.googleapis.com/css?family=Raleway' rel='stylesheet' type='text/css'>

    <!-- D3.js -->
    <!-- import version 3 as d3 -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/1.3.0/d3-legend.js" charset="utf-8"></script>
    <!-- import version 5 as d3v5 -->
    <script src="../lib/lib-d3v5/d3.v5.min.js" charset="utf-8"></script>
    <script src="../lib/lib-d3v5/d3-dsv.min.js" charset="utf-8"></script>
    <!--
    <script src="../lib/lib-d3v5/d3-fetch.min.js" charset="utf-8"></script>
        -->
    <script src="../lib/clustering/kmeans.js"></script>

    <script type="text/javascript" src="https://unpkg.com/imagekit-javascript/dist/imagekit.min.js"></script>

    <!-- Radar Chart Package -->
    <script src="../lib/updating-radar-chart-master/radarChart.js"></script>


  <!-- Position the map with Cascading Style Sheet (CSS) -->
    <style>
    .filterby{
        width: 10px;

        position: relative;
        left: 0px;

        vertical-align: left;
    }

    label {
        width: 300px;

        position: relative;
        left: 0px;

        display: inline-block;
        vertical-align: middle;
    }

    input[type = "checkbox"] {
        width: 18px;
        height: 18px;
    }

    input[type = "text"] {
        width: 200px;
        height: 20px;

        font-size: 0.8vw;
    }

    li{
        list-style-type: none;
    }


    #div1 {text-align: left; margin: 4px 2px; position: absolute; left : 50vw; top: 0vh; z-index:1; font-size: 0.8vw}
    #div2 {text-align: left; margin: 4px 2px; position: absolute; left : 36vw; top: 22vh;  z-index:1; font-size: 0.8vw; width:400px}
    #div3 {text-align: left; margin: 4px 2px; position: absolute; left : 48vw; top: 22vh;  z-index:1; font-size: 0.8vw; width:400px}
    #div4 {text-align: left; margin: 4px 2px; position: absolute; left : 20vw; top: -1vh; z-index:1; font-size: 0.8vw}
    #div5 {text-align: left; position: relative; left : 0px;  z-index:1; top: -10px; font-size: 0.8vw; width: 400px}
    #div6 {text-align: left; position: relative; left : 0px;  z-index:1; top: -10px; font-size: 0.8vw; width: 400px}
    #div7 {text-align: left; position: relative; left : 0px;  z-index:1; top: -10px; font-size: 0.8vw; width: 400px}

    #ABSAFeatureParentUp {text-align: left; margin: 4px 2px; position: absolute; left: 47.5vw; top: 0vh; z-index:1; font-size: 0.8vw; width: 15vw}
    #ABSAFeatureParent {text-align: left; margin: 4px 2px; position: relative; overflow: auto; z-index:1; top: -0.5vh; max-height: 16.8vh; min-height: 16.8vh; width:12vw; font-size: 0.8vw; max-height: 16vh}

    #chartFeatureParentUp {text-align: left; margin: 4px 2px; position: absolute; left: 59.5vw; top: 0vh; z-index:1; font-size: 0.8vw; width:14vw}
    #chartFeatureParent {text-align: left; margin: 4px 2px; position: relative; overflow: auto; z-index:1; width:12vw; font-size: 0.8vw; top: -0.5vh; max-height: 16.8vh; min-height: 16.8vh;}

    #locationFeatureParentUp {text-align: left; margin: 4px 2px; position: absolute; left: 35.5vw; top: 0vh; z-index:1; font-size: 0.8vw; width: 14vw}
    #locationFeatureParent {text-align: left; margin: 4px 2px; position: relative; overflow: auto; z-index:1; max-height: 16vh; min-height: 16vh; width: 12vw; font-size: 0.8vw; max-height:16vh}

    #radarChart {text-align: middle; margin: 4px 2px; width: 50px; position: absolute; left: 73vw; top: -5.5vh; font-size: 0.8vw}
    #update_radar_chart {text-align: middle; margin: 4px 2px; width: 5vw; position: absolute; right: 3vw; top: 37vh; z-index:1; font-size: 0.8vw}
    #clear_radar_chart {text-align: left; margin: 4px 2px; width: 5vw; position: absolute; right: 3vw; top: 39.5vh; z-index:1; font-size: 0.8vw}

    #sortListParentUp {text-align: left; margin: 4px 2px; position: absolute; left: 0vw; overflow: auto; width:36.46vw; top: 0vh;  font-size: 0.8vw;}
    #sortListParent {text-align: left; margin: 4px 2px; position: relative; left: 0px; z-index:1; top: 4vh; overflow: auto; max-height: 113.00vh; height: 113vh; font-size: 0.8vw;}
    #sortList {text-align: left; margin: 4px 2px; position: relative; top: 0px; right: 0px; z-index:1; height: 113vh; font-size: 0.7vw}

    #svg_buttonList {position:relative; top: -113vh; font-size: 0.8vw}

    #sortbylist {font-size:0.8vw; z-index: 1;}

    body {
          margin:0; padding:0;
          font-family: 'Open Sans', sans-serif;
          font-size: 0.85vw;
          font-weight: 750;
          text-align: left;
          text-shadow: 0 1px 0 #fff, 1px 0 0 #fff, -1px 0 0 #fff, 0 -1px 0 #fff;
          cursor: default;
          height: 1080px;
          width: 1920px;
          }

    #map { position: absolute; bottom: -20vh; left:36.5vw; height: 75vh; width: 62.5vw;}

    .rc_tooltip {
      font-size: 18px;
    }

    .leaflet-popup-tip-container {
     background: transparent;
     display: none;
    }


    .leaflet-popup-content-wrapper {
    border-radius: 0;
    border:3px solid rgba(0,0,0,0.4);
    }

    input[id="SearchBar"]{
      height: 2.1vh;
      width: 8vw;
    }

    /* .checkboxes label {
      display: block;
      padding-right: 10px;
      padding-left: 22px;
      text-indent: -22px;
    }
    .checkboxes input {
      vertical-align: middle;
    }
    .checkboxes label span {
      vertical-align: middle;
    } */
    </style>


</head>
<body>
        <canvas id = 'canvas'></canvas>
        <script src="../lib/canvas/canvas.js"></script>
        <!-- ABSA Feature -->
        <div id ="ABSAFeatureParentUp">
            <h3> &nbsp; &nbsp; &nbsp; ABSA Features</h3>
            <div id = "ABSAFeatureParent">
                <div class="ABSAFeature", id="div7">
                    <ul id="ABSA_chart_feature">
                        <!-- <li>
                            <input class="filterby" type="checkbox" id="CB101" value="Price" name="myCheckBox">
                            <label class="CB101">Price</label>
                        </li> -->
                        <li>
                            <input class="filterby" type="checkbox" id="CB109" value="Des_House" name="myCheckBox" checked>
                            <label for="CB109">Des_House</label>
                        </li>
                        <li>
                            <input class="filterby" type="checkbox" id="CB110" value="Des_Bed" name="myCheckBox" checked>
                            <label for="CB110">Des_Bed</label>
                        </li>
                        <li>
                            <input class="filterby" type="checkbox" id="CB111" value="Des_Kitchen" name="myCheckBox" checked>
                            <label for="CB111">Des_Kitchen</label>
                        </li>
                        <li>
                            <input class="filterby" type="checkbox" id="CB112" value="Des_Bathroom" name="myCheckBox" checked>
                            <label for="CB112">Des_Bathroom</label>
                        </li>
                        <li>
                            <input class="filterby" type="checkbox" id="CB113" value="Des_Livingroom" name="myCheckBox" checked>
                            <label for="CB113">Des_Livingroom</label>
                        </li>
                        <li>
                            <input class="filterby" type="checkbox" id="CB114" value="Des_Location" name="myCheckBox" checked>
                            <label for="CB114">Des_Location</label>
                        </li>
                        <li>
                            <input class="filterby" type="checkbox" id="CB115" value="Re_Host" name="myCheckBox" checked>
                            <label for="CB115">Re_Host</label>
                        </li>
                        <li>
                            <input class="filterby" type="checkbox" id="CB116" value="Re_House" name="myCheckBox" checked>
                            <label for="CB116">Re_House</label>
                        </li>
                        <li>
                            <input class="filterby" type="checkbox" id="CB117" value="Re_Location" name="myCheckBox" checked>
                            <label for="CB117">Re_Location</label>
                        </li>
                        <li>
                            <input class="filterby" type="checkbox" id="CB118" value="Re_Bed" name="myCheckBox" checked>
                            <label for="CB118">Re_Bed</label>
                        </li>
                        <li>
                            <input class="filterby" type="checkbox" id="CB119" value="Re_General" name="myCheckBox" checked>
                            <label for="CB119">Re_General</label>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="budget", id="div2">
            <h3>&nbsp; &nbsp; &nbsp;Your budget</h3>
            <ul>
                <li>
                    <input type="checkbox" id="CB7" name="myCheckBox" checked>
                    <label for="CB7">Less than $100</label>
                </li>
                <li>
                    <input type="checkbox" id="CB8" name="myCheckBox" checked>
                    <label for="CB8">$100 to $200</label>
                </li>
                <li>
                    <input type="checkbox" id="CB9" name="myCheckBox" checked>
                    <label for="CB9">$200 to $300</label>
                </li>
                <li>
                    <input type="checkbox" id="CB10" name="myCheckBox" checked>
                    <label for="CB10">More than $300</label>
                </li>
            </ul>
        </div>
        <div class="property_type", id="div3">
            <h3>&nbsp; &nbsp; &nbsp;Property type</h3>
            <ul>
                <li>
                    <input type="checkbox" id="CB11" name="myCheckBox" checked>
                    <label for="CB11">Entire home/apt</label>
                </li>
                <li>
                    <input type="checkbox" id="CB12" name="myCheckBox" checked>
                    <label for="CB12">Private room</label>
                </li>
                <li>
                    <input type="checkbox" id="CB13" name="myCheckBox" checked>
                    <label for="CB13">Shared toom</label>
                </li>
                <li>
                    <input type="checkbox" id="CB14" name="myCheckBox" checked>
                    <label for="CB14">Hotel room</label>
                </li>
            </ul>
        </div>

        <!-- Dropdown button -->
        <div class="sele", id="div4">
            <h3>Sorting
            <select id="sortbylist">
                <option value="Default">Default</option>
                <option value="priceDescending">Price - Descending</option>
                <option value="priceAscending">Price - Ascending</option>
                <option value="guestRating">Guest Rating</option>
            </select></h3>
        </div>

        <!-- Radar chart feature -->
        <div id ="chartFeatureParentUp">
            <h3> &nbsp; &nbsp; &nbsp; Radar Chart Features</h3>
            <div id = "chartFeatureParent">
                <div class="chartFeature", id="div5">
                    <ul id="radar_chart_feature">
                        <!-- <li>
                            <input class="filterby" type="checkbox" id="CB15" value="House" name="myCheckBox" checked>
                            <label for="CB1">Price</label>
                        </li>
                        <li>
                            <input class="filterby" type="checkbox" id="CB16" value="Bed" name="myCheckBox" checked>
                            <label for="CB2">Rating</label>
                        </li>
                        <li>
                            <input class="filterby" type="checkbox" id="CB17" value="Kitchen" name="myCheckBox" checked>
                            <label for="CB3">Cleanliness</label>
                        </li> -->
                    </ul>
                </div>
            </div>
        </div>

        <!-- Location feature -->
        <div id ="locationFeatureParentUp">
            <h3>&nbsp; &nbsp; &nbsp;
                <input id="SearchBar" placeholder="Search for districts" type="text" oninput="updateCheckboxes(this)" autocomplete="off">
            </h3>
            <div id = "locationFeatureParent">
                <div class="locationFeature", id="div6">
                    <ul id="location_feature">
                        <!-- <li>
                            <input class="locationfilter" type="checkbox" id="CB15" value="House" name="myCheckBox" checked>
                            <label for="CB1">Loc1</label>
                        </li>
                        <li>
                            <input class="locationfilter" type="checkbox" id="CB16" value="Bed" name="myCheckBox" checked>
                            <label for="CB2">Loc2</label>
                        </li>
                        <li>
                            <input class="locationfilter" type="checkbox" id="CB17" value="Kitchen" name="myCheckBox" checked>
                            <label for="CB3">Loc3</label>
                        </li>
                        <li>
                            <input class="locationfilter" type="checkbox" id="CB18" value="House" name="myCheckBox" checked>
                            <label for="CB1">Loc4</label>
                        </li>
                        <li>
                            <input class="locationfilter" type="checkbox" id="CB19" value="Bed" name="myCheckBox" checked>
                            <label for="CB2">Loc5</label>
                        </li>
                        <li>
                            <input class="locationfilter" type="checkbox" id="CB20" value="Kitchen" name="myCheckBox" checked>
                            <label for="CB3">Loc6</label>
                        </li> -->
                    </ul>
                </div>
            </div>
        </div>
    <!-- Insert HTML division tag to layout the map -->
    <div id="map"></div>

    <!-- Radar Chart Update Buttons-->
    <div id = "update_radar_chart">
          <input name = "update radar chart"
                  type = "button"
                  value = "Update Radar Chart"
                  onclick = "updateRC()"
                 style = "font-size : 0.6vw"
          />
    </div>

    <div id = "clear_radar_chart">
        <input name = "clear radar chart"
                type = "button"
                value = "Clear Radar chart"
               style = "font-size : 0.6vw"
                onclick = "clearRC()" />
    </div>

    <!-- Radar Chart-->
    <div id="radarChart"></div>

    <!-- Sort List -->
    <div id = "sortListParentUp">
        <div id = "sortListParent">
            <div id="sortList"></div>
        </div>
    </div>
    </body>

    <script>
// Section One - Initialization

        // define window.length and window.height
        var wlength = window.innerWidth
        var wheight = window.innerHeight

        //console.log(wlength)
        //console.log(wheight)

        // define global CSV path
        var CSV_path="data_output.csv"

        let enabledSettings = []

        // define output, as a global variable
        var data_w_cluster = []

    // Map
        // Set up initial map center and zoom level
        var map = L.map('map', {
                    center: [34.05, -118.25], // EDIT latitude, longitude to re-center map
                    zoom: 10,  // EDIT from 1 to 18 -- decrease to zoom out, increase to zoom in
                    scrollWheelZoom: true,
                    tap: false
                  });

        var markersLayer = new L.LayerGroup();

        /* Control panel to display map layers */
        var controlLayers = L.control.layers( null, null, {
                              position: "topright",
                              collapsed: false
                            }).addTo(map);


        var OpenStreetMap_Mapnik = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                                        maxZoom: 19,
                                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                                    }).addTo(map);
                                    controlLayers.addBaseLayer(OpenStreetMap_Mapnik, 'Open Street Map');


        // display Carto basemap tiles with light features and labels
        var light = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
                      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>, &copy; <a href="https://carto.com/attribution">CARTO</a>'
                    }); // EDIT - insert or remove ".addTo(map)" before last semicolon to display by default
                    controlLayers.addBaseLayer(light, 'Carto Light basemap');

        /* Stamen colored terrain basemap tiles with labels */
        var terrain = L.tileLayer('https://stamen-tiles.a.ssl.fastly.net/terrain/{z}/{x}/{y}.png', {
                        attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.'
                      }); // EDIT - insert or remove ".addTo(map)" before last semicolon to display by default
                      controlLayers.addBaseLayer(terrain, 'Stamen Terrain basemap');

        // see more basemap options at https://leaflet-extras.github.io/leaflet-providers/preview/


        // Define different Icon colors
        var greenIcon = new L.Icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
          iconSize: [25, 41],
          iconAnchor: [12, 41],
         popupAnchor: [1, -34],
          shadowSize: [41, 41]
        });

        var redIcon = new L.Icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
          iconSize: [25, 41],
          iconAnchor: [12, 41],
          popupAnchor: [1, -34],
          shadowSize: [41, 41]
        });

        var blueIcon = new L.Icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
          iconSize: [25, 41],
          iconAnchor: [12, 41],
          popupAnchor: [1, -34],
          shadowSize: [41, 41]
        });

        var goldIcon = new L.Icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png',
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
          iconSize: [25, 41],
          iconAnchor: [12, 41],
          popupAnchor: [1, -34],
          shadowSize: [41, 41]
        });

        var violetIcon = new L.Icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png',
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
          iconSize: [25, 41],
          iconAnchor: [12, 41],
          popupAnchor: [1, -34],
          shadowSize: [41, 41]
        });


        // Create array to store icon colors
        var Icon_Color = [redIcon, goldIcon, blueIcon, violetIcon, greenIcon]

        var big_icon_size = [30,50]
        var big_greenIcon = new L.Icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png',
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
          iconSize: big_icon_size,
          iconAnchor: [12, 41],
          popupAnchor: [1, -34],
          shadowSize: [41, 41]
        });

        var big_redIcon = new L.Icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
          iconSize: big_icon_size,
          iconAnchor: [12, 41],
          popupAnchor: [1, -34],
          shadowSize: [41, 41]
        });

        var big_blueIcon = new L.Icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-blue.png',
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
          iconSize: big_icon_size,
          iconAnchor: [12, 41],
          popupAnchor: [1, -34],
          shadowSize: [41, 41]
        });

        var big_goldIcon = new L.Icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png',
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
          iconSize: big_icon_size,
          iconAnchor: [12, 41],
          popupAnchor: [1, -34],
          shadowSize: [41, 41]
        });

        var big_violetIcon = new L.Icon({
          iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-violet.png',
          shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
          iconSize: big_icon_size,
          iconAnchor: [12, 41],
          popupAnchor: [1, -34],
          shadowSize: [41, 41]
        });


        // Create array to store big icon colors
        var big_Icon_Color = [big_redIcon, big_goldIcon, big_blueIcon, big_violetIcon, big_greenIcon]

    // Radar Chart
        // Create array to store radar chart values
        var data_RC = new Array();
        var data_RC_update = new Array();

        // Define Radar Chart Output Color
        var color = d3.scale.ordinal()
            .range(["#1F3D51","#e49444","#d1615d", "#85b6b2", "#6a9f58", "#e7ca60", "#a87c9f", "#f1a2a9", "#967662", "#b8b0ac"]);


        // Define input features
        var RC_name = ["Price", "Rating", "Cleanliness"]
        var RC_name_copy = ["Price", "Rating", "Cleanliness"]

        var radarChartOptions = {
            width: 520 * wlength/1920,
            height: 520 * wheight/980,
            color: color,
        };


        radarChart = RadarChart()


        var svg_rc = d3.select("#radarChart")
            .append("svg")
            .attr("id", "svg_radarChart")
            .attr("width", 550 * wlength/1920)
            .attr("height", 550 * wheight/980)

        svg_rc.call(radarChart)
        radarChart.options(radarChartOptions).update();

        // Sort List
        var button_height = 30 * Math.sqrt(wlength/1920)
        var button_width = 30 * Math.sqrt(wlength/1920)
        var num_page = 20

        var svg_bu = d3v5.select("#sortListParentUp")
        //var svg_bu = d3v5.select("#sortList")
                    .append("svg")
                    .attr("id", "svg_buttonList")
                    .attr("width", 700 * wlength/1920)
                    .attr("height", button_height)

        var svg_sl = d3v5.select("#sortList")
                    .append("svg")
                    .attr("id", "svg_sortList")
                    .attr("width", 700 * wlength/1920)


        var selectedGame = []

//Section Two - Main Program
        // Inatialzie Data with customizable checkboxes
        var checkboxes = document.querySelectorAll("input[type=checkbox][name=myCheckBox]");
        var flag=0
        loadCSVwithFilters(checkboxes)

        // event listener for the district selection
        document.getElementById("location_feature").addEventListener("click", displayCheck);
        function displayCheck() {
            loadCSVwithFilters(checkboxes);
        }

        // event listener for the checkboxes.
        checkboxes.forEach(function(checkbox){
            checkbox.addEventListener('change', function() {
                loadCSVwithFilters(checkboxes);
            })
        })

        // event listener for the dropdown. Update choropleth and legend when selection changes. Call createMapAndLegend() with required arguments.
        document.getElementById('sortbylist').addEventListener('change', function(){

            selectedGame = this.value

            sortBySelectedFeature(data_w_cluster, this.value)
            updateSortList(data_w_cluster, selectedGame)
        })       

//Section Three - Functions
//Functions Start from Here
        // this function dynamically load csv data based on multiple checkboxes
        function loadCSVwithFilters(checkboxes){
                    data = d3v5.dsv(",", CSV_path, function (d) {
                    return {
                    // format data attributes if required
                        id: +d.id,
                        Title: d.Title,
                        Description: d.Description,
                        image: d.picture_url,
                        Type: d.room_type,
                        position: d.neighbourhood_cleansed,
                        Latitude: d.Latitude,
                        Longitude: d.Longitude,
                        Price: d.price,
                        Rating: +d.review_scores_rating,
                        accuracy: +d.review_scores_accuracy,
                        Cleanliness: +d.review_scores_cleanliness,
                        checkin: +d.review_scores_checkin,
                        communication: +d.review_scores_communication,
                        locate: +d.review_scores_location,
                        value: +d.review_scores_value,
                        Des_House: +d.des_house,
                        Des_Bed: +d.des_bed,
                        Des_Kitchen: +d.des_kitchen,
                        Des_Bathroom: +d.des_bathroom,
                        Des_Livingroom: +d.des_livingroom,
                        Des_Location: +d.des_location,
                        Re_Host: +d.re_host,
                        Re_House: +d.re_house,
                        Re_Location: +d.re_location,
                        Re_Bed: +d.re_bed,
                        Re_General: +d.re_general,                       
                        }
                    }).then(function (data) {

                        //console.log(data)

                        data.forEach(function(v){
                            v.Price = parseFloat(v.Price.replace('$',' '))
                            return v
                        })

                        // // cb101 to cb119 are for filters
                        // const cb101 = document.getElementById('CB101')
                        // if(cb101.checked!==true){
                        //     data.forEach(function(v){
                        //     delete v.Price
                        //     return v
                        // });
                        // }

                        // const cb102 = document.getElementById('CB102')
                        // if(cb102.checked!==true){
                        //     data.forEach(function(v){
                        //     delete v.review_scores_rating
                        //     return v
                        // });
                        // }

                        // const cb103 = document.getElementById('CB103')
                        // if(cb103.checked!==true){
                        //     data.forEach(function(v){
                        //     delete v.review_scores_accuracy
                        //     return v
                        // });
                        // }

                        // const cb104 = document.getElementById('CB104')
                        // if(cb104.checked!==true){
                        //     data.forEach(function(v){
                        //     delete v.review_scores_cleanliness
                        //     return v
                        // });
                        // }

                        // const cb105 = document.getElementById('CB105')
                        // if(cb105.checked!==true){
                        //     data.forEach(function(v){
                        //     delete v.review_scores_checkin
                        //     return v
                        // });
                        // }

                        // const cb106 = document.getElementById('CB106')
                        // if(cb106.checked!==true){
                        //     data.forEach(function(v){
                        //     delete v.review_scores_communication
                        //     return v
                        // });
                        // }

                        // const cb107 = document.getElementById('CB107')
                        // if(cb107.checked!==true){
                        //     data.forEach(function(v){
                        //     delete v.review_scores_location
                        //     return v
                        // });
                        // }

                        // const cb108 = document.getElementById('CB108')
                        // if(cb108.checked!==true){
                        //     data.forEach(function(v){
                        //     delete v.review_scores_value
                        //     return v
                        // });
                        // }

                        const cb109 = document.getElementById('CB109')
                        if(cb109.checked!==true){
                            data.forEach(function(v){
                            delete v.Des_House
                            return v
                        });
                        }

                        const cb110 = document.getElementById('CB110')
                        if(cb110.checked!==true){
                            data.forEach(function(v){
                            delete v.Des_Bed
                            return v
                        });
                        }

                        const cb111 = document.getElementById('CB111')
                        if(cb111.checked!==true){
                            data.forEach(function(v){
                            delete v.Des_Kitchen
                            return v
                        });
                        }

                        const cb112 = document.getElementById('CB112')
                        if(cb112.checked!==true){
                            data.forEach(function(v){
                            delete v.Des_Bathroom
                            return v
                        });
                        }

                        const cb113 = document.getElementById('CB113')
                        if(cb113.checked!==true){
                            data.forEach(function(v){
                            delete v.Des_Livingroom
                            return v
                        });
                        }

                        const cb114 = document.getElementById('CB114')
                        if(cb114.checked!==true){
                            data.forEach(function(v){
                            delete v.Des_Location
                            return v
                        });
                        }

                        const cb115 = document.getElementById('CB115')
                        if(cb115.checked!==true){
                            data.forEach(function(v){
                            delete v.Re_Host
                            return v
                        });
                        }

                        const cb116 = document.getElementById('CB116')
                        if(cb116.checked!==true){
                            data.forEach(function(v){
                            delete v.Re_House
                            return v
                        });
                        }

                        const cb117 = document.getElementById('CB117')
                        if(cb117.checked!==true){
                            data.forEach(function(v){
                            delete v.Re_Location
                            return v
                        });
                        }

                        const cb118 = document.getElementById('CB118')
                        if(cb118.checked!==true){
                            data.forEach(function(v){
                            delete v.Re_Bed
                            return v
                        });
                        }

                        const cb119 = document.getElementById('CB119')
                        if(cb119.checked!==true){
                            data.forEach(function(v){
                            delete v.Re_General
                            return v
                        });
                        }

                        // cb7 to cb10 are for price filter
                        const cb7 = document.getElementById('CB7')
                        const cb8 = document.getElementById('CB8')
                        const cb9 = document.getElementById('CB9')
                        const cb10 = document.getElementById('CB10')

                        // cb11 to cb14 are for property type filter
                        const cb11 = document.getElementById('CB11')
                        const cb12 = document.getElementById('CB12')
                        const cb13 = document.getElementById('CB13')
                        const cb14 = document.getElementById('CB14')

                        if(cb7.checked!==true && cb8.checked!==true && cb9.checked!==true && cb10.checked!==true){
                            alert("No price range selected!")
                            return
                        }

                        if(cb11.checked!==true && cb12.checked!==true && cb13.checked!==true && cb14.checked!==true){
                            alert("No property type selected!")
                            return
                        }

                        //console.log(data)

                        //Filter data by price
                        var data_filterby_price = new Array()
                        if(cb7.checked ==true){
                            for (i=0;i<data.length;i++){
                                if(data[i].Price < 100){
                                    data_filterby_price.push(data[i])
                                }
                            }
                        };
            
                        if(cb8.checked ==true){
                            for (i=0;i<data.length;i++){
                                if(data[i].Price>=100 && data[i].Price <200){
                                    data_filterby_price.push(data[i])
                                }
                            }
                        };

                        if(cb9.checked ==true){
                            for (i=0;i<data.length;i++){
                                if(data[i].Price>=200 && data[i].Price < 300){
                                    data_filterby_price.push(data[i])
                                }
                            }
                        };

                        if(cb10.checked ==true){
                            for (i=0;i<data.length;i++){
                                if(data[i].Price>=300){
                                    data_filterby_price.push(data[i])
                                }
                            }
                        };

                        //console.log(data_filterby_price)

                        //Filter data by property type
                        var data_filterby_propertytype = new Array()
                        if(cb11.checked==true){
                            for (i=0;i<data_filterby_price.length;i++){
                                if(data_filterby_price[i].Type=="Entire home/apt"){
                                    data_filterby_propertytype.push(data_filterby_price[i])
                                }
                            }
                        }
                        if(cb12.checked==true){
                            for (i=0;i<data_filterby_price.length;i++){
                                if(data_filterby_price[i].Type=="Private room"){
                                    data_filterby_propertytype.push(data_filterby_price[i])
                                }
                            }
                        }  
                        if(cb13.checked==true){
                            for (i=0;i<data_filterby_price.length;i++){
                                if(data_filterby_price[i].Type=="Shared room"){
                                    data_filterby_propertytype.push(data_filterby_price[i])
                                }
                            }
                        }
                        if(cb14.checked==true){
                            for (i=0;i<data_filterby_price.length;i++){
                                if(data_filterby_price[i].Type=="Hotel room"){
                                    data_filterby_propertytype.push(data_filterby_price[i])
                                }
                            }
                        }

                        // House Description check box
                        if(cb109.checked==true){
                            if (RC_name.indexOf("Des_House") == -1){
                                RC_name.push("Des_House")

                                var rad_feature = document.getElementById('radar_chart_feature')
                                var op1 = document.createElement('li')

                                var feature1 = document.createElement('input')
                                    feature1.type = "checkbox"
                                    feature1.value = "Des_House"
                                    feature1.name = "myCheckBox"
                                    feature1.class = "filterby"
                                    feature1.id = "CB209"

                                var label = document.createElement('label')
                                    label.htmlFor = "CB209"
                                    label.id = "CB209_label"
                                    label.appendChild(document.createTextNode("Des_House"))

                                op1.appendChild(feature1)
                                op1.appendChild(label)
                                rad_feature.appendChild(op1)
                            }     
                        }
                        else{
                            if (RC_name.indexOf("Des_House") > -1){
                                RC_name = RC_name.filter(e => e !== 'Des_House') 

                                document.getElementById("CB209").remove()
                                document.getElementById("CB209_label").remove()                                
                            }                     
                        }

                        // Bed Description check box
                        if(cb110.checked==true){
                            if (RC_name.indexOf("Des_Bed") == -1){
                                RC_name.push("Des_Bed")

                                var rad_feature = document.getElementById('radar_chart_feature')
                                var op1 = document.createElement('li')

                                var feature1 = document.createElement('input')
                                    feature1.type = "checkbox"
                                    feature1.value = "Des_Bed"
                                    feature1.name = "myCheckBox"
                                    feature1.class = "filterby"
                                    feature1.id = "CB210"

                                var label = document.createElement('label')
                                    label.htmlFor = "CB210"
                                    label.id = "CB210_label"
                                    label.appendChild(document.createTextNode("Des_Bed"))

                                op1.appendChild(feature1)
                                op1.appendChild(label)
                                rad_feature.appendChild(op1)
                            }     
                        }
                        else{
                            if (RC_name.indexOf("Des_Bed") > -1){
                                RC_name = RC_name.filter(e => e !== 'Des_Bed') 

                                document.getElementById("CB210").remove()
                                document.getElementById("CB210_label").remove()                                
                            }                     
                        }

                        // Kitchen Description check box
                        if(cb111.checked==true){
                            if (RC_name.indexOf("Des_Kitchen") == -1){
                                RC_name.push("Des_Kitchen")

                                var rad_feature = document.getElementById('radar_chart_feature')
                                var op1 = document.createElement('li')

                                var feature1 = document.createElement('input')
                                    feature1.type = "checkbox"
                                    feature1.value = "Des_Kitchen"
                                    feature1.name = "myCheckBox"
                                    feature1.class = "filterby"
                                    feature1.id = "CB211"

                                var label = document.createElement('label')
                                    label.htmlFor = "CB211"
                                    label.id = "CB211_label"
                                    label.appendChild(document.createTextNode("Des_Kitchen"))

                                op1.appendChild(feature1)
                                op1.appendChild(label)
                                rad_feature.appendChild(op1)
                            }     
                        }
                        else{
                            if (RC_name.indexOf("Des_Kitchen") > -1){
                                RC_name = RC_name.filter(e => e !== 'Des_Kitchen') 

                                document.getElementById("CB211").remove()
                                document.getElementById("CB211_label").remove()                                
                            }                     
                        }

                        // Bathroom Description check box
                        if(cb112.checked==true){
                            if (RC_name.indexOf("Des_Bathroom") == -1){
                                RC_name.push("Des_Bathroom")

                                var rad_feature = document.getElementById('radar_chart_feature')
                                var op1 = document.createElement('li')

                                var feature1 = document.createElement('input')
                                    feature1.type = "checkbox"
                                    feature1.value = "Des_Bathroom"
                                    feature1.name = "myCheckBox"
                                    feature1.class = "filterby"
                                    feature1.id = "CB212"

                                var label = document.createElement('label')
                                    label.htmlFor = "CB212"
                                    label.id = "CB212_label"
                                    label.appendChild(document.createTextNode("Des_Bathroom"))

                                op1.appendChild(feature1)
                                op1.appendChild(label)
                                rad_feature.appendChild(op1)
                            }     
                        }
                        else{
                            if (RC_name.indexOf("Des_Bathroom") > -1){
                                RC_name = RC_name.filter(e => e !== 'Des_Bathroom') 

                                document.getElementById("CB212").remove()
                                document.getElementById("CB212_label").remove()                                
                            }                     
                        }

                        // Livingroom Description check box
                        if(cb113.checked==true){
                            if (RC_name.indexOf("Des_Livingroom") == -1){
                                RC_name.push("Des_Livingroom")

                                var rad_feature = document.getElementById('radar_chart_feature')
                                var op1 = document.createElement('li')

                                var feature1 = document.createElement('input')
                                    feature1.type = "checkbox"
                                    feature1.value = "Des_Livingroom"
                                    feature1.name = "myCheckBox"
                                    feature1.class = "filterby"
                                    feature1.id = "CB213"

                                var label = document.createElement('label')
                                    label.htmlFor = "CB213"
                                    label.id = "CB213_label"
                                    label.appendChild(document.createTextNode("Des_Livingroom"))

                                op1.appendChild(feature1)
                                op1.appendChild(label)
                                rad_feature.appendChild(op1)
                            }     
                        }
                        else{
                            if (RC_name.indexOf("Des_Livingroom") > -1){
                                RC_name = RC_name.filter(e => e !== 'Des_Livingroom') 

                                document.getElementById("CB213").remove()
                                document.getElementById("CB213_label").remove()                                
                            }                     
                        }

                        // Location Description check box
                        if(cb114.checked==true){
                            if (RC_name.indexOf("Des_Location") == -1){
                                RC_name.push("Des_Location")

                                var rad_feature = document.getElementById('radar_chart_feature')
                                var op1 = document.createElement('li')

                                var feature1 = document.createElement('input')
                                    feature1.type = "checkbox"
                                    feature1.value = "Des_Location"
                                    feature1.name = "myCheckBox"
                                    feature1.class = "filterby"
                                    feature1.id = "CB214"

                                var label = document.createElement('label')
                                    label.htmlFor = "CB214"
                                    label.id = "CB214_label"
                                    label.appendChild(document.createTextNode("Des_Location"))

                                op1.appendChild(feature1)
                                op1.appendChild(label)
                                rad_feature.appendChild(op1)
                            }     
                        }
                        else{
                            if (RC_name.indexOf("Des_Location") > -1){
                                RC_name = RC_name.filter(e => e !== 'Des_Location') 

                                document.getElementById("CB214").remove()
                                document.getElementById("CB214_label").remove()                                
                            }                     
                        }

                        // Host Review check box
                        if(cb115.checked==true){
                            if (RC_name.indexOf("Re_Host") == -1){
                                RC_name.push("Re_Host")

                                var rad_feature = document.getElementById('radar_chart_feature')
                                var op1 = document.createElement('li')

                                var feature1 = document.createElement('input')
                                    feature1.type = "checkbox"
                                    feature1.value = "Re_Host"
                                    feature1.name = "myCheckBox"
                                    feature1.class = "filterby"
                                    feature1.id = "CB215"

                                var label = document.createElement('label')
                                    label.htmlFor = "CB215"
                                    label.id = "CB215_label"
                                    label.appendChild(document.createTextNode("Re_Host"))

                                op1.appendChild(feature1)
                                op1.appendChild(label)
                                rad_feature.appendChild(op1)
                            }     
                        }
                        else{
                            if (RC_name.indexOf("Re_Host") > -1){
                                RC_name = RC_name.filter(e => e !== 'Re_Host') 

                                document.getElementById("CB215").remove()
                                document.getElementById("CB215_label").remove()                                
                            }                     
                        }

                        // House Review check box
                        if(cb116.checked==true){
                            if (RC_name.indexOf("Re_House") == -1){
                                RC_name.push("Re_House")

                                var rad_feature = document.getElementById('radar_chart_feature')
                                var op1 = document.createElement('li')

                                var feature1 = document.createElement('input')
                                    feature1.type = "checkbox"
                                    feature1.value = "Re_House"
                                    feature1.name = "myCheckBox"
                                    feature1.class = "filterby"
                                    feature1.id = "CB216"

                                var label = document.createElement('label')
                                    label.htmlFor = "CB216"
                                    label.id = "CB216_label"
                                    label.appendChild(document.createTextNode("Re_House"))

                                op1.appendChild(feature1)
                                op1.appendChild(label)
                                rad_feature.appendChild(op1)
                            }     
                        }
                        else{
                            if (RC_name.indexOf("Re_House") > -1){
                                RC_name = RC_name.filter(e => e !== 'Re_House') 

                                document.getElementById("CB216").remove()
                                document.getElementById("CB216_label").remove()                                
                            }                     
                        }

                        // Location Review check box
                        if(cb117.checked==true){
                            if (RC_name.indexOf("Re_Location") == -1){
                                RC_name.push("Re_Location")

                                var rad_feature = document.getElementById('radar_chart_feature')
                                var op1 = document.createElement('li')

                                var feature1 = document.createElement('input')
                                    feature1.type = "checkbox"
                                    feature1.value = "Re_Location"
                                    feature1.name = "myCheckBox"
                                    feature1.class = "filterby"
                                    feature1.id = "CB217"

                                var label = document.createElement('label')
                                    label.htmlFor = "CB217"
                                    label.id = "CB217_label"
                                    label.appendChild(document.createTextNode("Re_Location"))

                                op1.appendChild(feature1)
                                op1.appendChild(label)
                                rad_feature.appendChild(op1)
                            }     
                        }
                        else{
                            if (RC_name.indexOf("Re_Location") > -1){
                                RC_name = RC_name.filter(e => e !== 'Re_Location') 

                                document.getElementById("CB217").remove()
                                document.getElementById("CB217_label").remove()                                
                            }                     
                        }

                        // Bed Review check box
                        if(cb118.checked==true){
                            if (RC_name.indexOf("Re_Bed") == -1){
                                RC_name.push("Re_Bed")

                                var rad_feature = document.getElementById('radar_chart_feature')
                                var op1 = document.createElement('li')

                                var feature1 = document.createElement('input')
                                    feature1.type = "checkbox"
                                    feature1.value = "Re_Bed"
                                    feature1.name = "myCheckBox"
                                    feature1.class = "filterby"
                                    feature1.id = "CB218"

                                var label = document.createElement('label')
                                    label.htmlFor = "CB218"
                                    label.id = "CB218_label"
                                    label.appendChild(document.createTextNode("Re_Bed"))

                                op1.appendChild(feature1)
                                op1.appendChild(label)
                                rad_feature.appendChild(op1)
                            }     
                        }
                        else{
                            if (RC_name.indexOf("Re_Bed") > -1){
                                RC_name = RC_name.filter(e => e !== 'Re_Bed') 

                                document.getElementById("CB218").remove()
                                document.getElementById("CB218_label").remove()                                
                            }                     
                        }

                        // General Review check box
                        if(cb119.checked==true){
                            if (RC_name.indexOf("Re_General") == -1){
                                RC_name.push("Re_General")

                                var rad_feature = document.getElementById('radar_chart_feature')
                                var op1 = document.createElement('li')

                                var feature1 = document.createElement('input')
                                    feature1.type = "checkbox"
                                    feature1.value = "Re_General"
                                    feature1.name = "myCheckBox"
                                    feature1.class = "filterby"
                                    feature1.id = "CB219"

                                var label = document.createElement('label')
                                    label.htmlFor = "CB219"
                                    label.id = "CB219_label"
                                    label.appendChild(document.createTextNode("Re_General"))

                                op1.appendChild(feature1)
                                op1.appendChild(label)
                                rad_feature.appendChild(op1)
                            }     
                        }
                        else{
                            if (RC_name.indexOf("Re_General") > -1){
                                RC_name = RC_name.filter(e => e !== 'Re_General') 

                                document.getElementById("CB219").remove()
                                document.getElementById("CB219_label").remove()                                
                            }                     
                        }

                        //update RC_name: House Description
                        var radarChartFeature9=document.getElementById("CB209")
                        if (radarChartFeature9!==null){
                            radarChartFeature9.addEventListener('change',function(){
                                if(radarChartFeature9.checked===false){
                                    RC_name_copy = RC_name_copy.filter(e => e !== 'Des_House')
                                    //console.log(RC_name_copy)
                                }else{
                                    if (RC_name_copy.indexOf('Des_House') == -1)
                                        RC_name_copy.push('Des_House')
                                    //console.log(RC_name_copy)
                            }
                            })
                        }

                        //update RC_name: Bed Description
                        var radarChartFeature10=document.getElementById("CB210")
                        if (radarChartFeature10!==null){
                            radarChartFeature10.addEventListener('change',function(){
                                if(radarChartFeature10.checked===false){
                                    RC_name_copy = RC_name_copy.filter(e => e !== 'Des_Bed')
                                    //console.log(RC_name_copy)
                                }else{
                                    if (RC_name_copy.indexOf('Des_Bed') == -1)
                                        RC_name_copy.push('Des_Bed')
                                    //console.log(RC_name_copy)
                            }
                            })
                        }

                        //update RC_name: Kitchen Description
                        var radarChartFeature11=document.getElementById("CB211")
                        if (radarChartFeature11!==null){
                            radarChartFeature11.addEventListener('change',function(){
                                if(radarChartFeature11.checked===false){
                                    RC_name_copy = RC_name_copy.filter(e => e !== 'Des_Kitchen')
                                    //console.log(RC_name_copy)
                                }else{
                                    if (RC_name_copy.indexOf('Des_Kitchen') == -1)
                                        RC_name_copy.push('Des_Kitchen')
                                    //console.log(RC_name_copy)
                            }
                            })
                        }

                        //update RC_name: Bathroom Description
                        var radarChartFeature12=document.getElementById("CB212")
                        if (radarChartFeature12!==null){
                            radarChartFeature12.addEventListener('change',function(){
                                if(radarChartFeature12.checked===false){
                                    RC_name_copy = RC_name_copy.filter(e => e !== 'Des_Bathroom')
                                    //console.log(RC_name_copy)
                                }else{
                                    if (RC_name_copy.indexOf('Des_Bathroom') == -1)
                                        RC_name_copy.push('Des_Bathroom')
                                    //console.log(RC_name_copy)
                            }
                            })
                        }

                        //update RC_name: Livingroom Description
                        var radarChartFeature13=document.getElementById("CB213")
                        if (radarChartFeature13!==null){
                            radarChartFeature13.addEventListener('change',function(){
                                if(radarChartFeature13.checked===false){
                                    RC_name_copy = RC_name_copy.filter(e => e !== 'Des_Livingroom')
                                    //console.log(RC_name_copy)
                                }else{
                                    if (RC_name_copy.indexOf('Des_Livingroom') == -1)
                                        RC_name_copy.push('Des_Livingroom')
                                    //console.log(RC_name_copy)
                            }
                            })
                        }

                        //update RC_name: Location Description
                        var radarChartFeature14=document.getElementById("CB214")
                        if (radarChartFeature14!==null){
                            radarChartFeature14.addEventListener('change',function(){
                                if(radarChartFeature14.checked===false){
                                    RC_name_copy = RC_name_copy.filter(e => e !== 'Des_Location')
                                    //console.log(RC_name_copy)
                                }else{
                                    if (RC_name_copy.indexOf('Des_Location') == -1)
                                        RC_name_copy.push('Des_Location')
                                    //console.log(RC_name_copy)
                            }
                            })
                        }

                        //update RC_name: Host Review
                        var radarChartFeature15=document.getElementById("CB215")
                        if (radarChartFeature15!==null){
                            radarChartFeature15.addEventListener('change',function(){
                                if(radarChartFeature15.checked===false){
                                    RC_name_copy = RC_name_copy.filter(e => e !== 'Re_Host')
                                    //console.log(RC_name_copy)
                                }else{
                                    if (RC_name_copy.indexOf('Re_Host') == -1)
                                        RC_name_copy.push('Re_Host')
                                    //console.log(RC_name_copy)
                            }
                            })
                        }

                        //update RC_name: House Review
                        var radarChartFeature16=document.getElementById("CB216")
                        if (radarChartFeature16!==null){
                            radarChartFeature16.addEventListener('change',function(){
                                if(radarChartFeature16.checked===false){
                                    RC_name_copy = RC_name_copy.filter(e => e !== 'Re_House')
                                    //console.log(RC_name_copy)
                                }else{
                                    if (RC_name_copy.indexOf('Re_House') == -1)
                                        RC_name_copy.push('Re_House')
                                    //console.log(RC_name_copy)
                            }
                            })
                        }

                        //update RC_name: Location Review
                        var radarChartFeature17=document.getElementById("CB217")
                        if (radarChartFeature17!==null){
                            radarChartFeature17.addEventListener('change',function(){
                                if(radarChartFeature17.checked===false){
                                    RC_name_copy = RC_name_copy.filter(e => e !== 'Re_Location')
                                    //console.log(RC_name_copy)
                                }else{
                                    if (RC_name_copy.indexOf('Re_Location') == -1)
                                        RC_name_copy.push('Re_Location')
                                    //console.log(RC_name_copy)
                            }
                            })
                        }

                        //update RC_name: Bed Review
                        var radarChartFeature18=document.getElementById("CB218")
                        if (radarChartFeature18!==null){
                            radarChartFeature18.addEventListener('change',function(){
                                if(radarChartFeature18.checked===false){
                                    RC_name_copy = RC_name_copy.filter(e => e !== 'Re_Bed')
                                    //console.log(RC_name_copy)
                                }else{
                                    if (RC_name_copy.indexOf('Re_Bed') == -1)
                                        RC_name_copy.push('Re_Bed')
                                    //console.log(RC_name_copy)
                            }
                            })
                        }

                        //update RC_name: General Review
                        var radarChartFeature19=document.getElementById("CB219")
                        if (radarChartFeature19!==null){
                            radarChartFeature19.addEventListener('change',function(){
                                if(radarChartFeature19.checked===false){
                                    RC_name_copy = RC_name_copy.filter(e => e !== 'Re_General')
                                    //console.log(RC_name_copy)
                                }else{
                                    if (RC_name_copy.indexOf('Re_General') == -1)
                                        RC_name_copy.push('Re_General')
                                    //console.log(RC_name_copy)
                            }
                            })
                        }


                        //Get location column
                        var property_location = new Array()
                        property_location = data.map(function(value,index) { return value['position'];})

                        // Drop duplicated selections
                        var unique_property_location = property_location.filter(function(elem, pos){
                                            return property_location.indexOf(elem) == pos;
                                        })
                        unique_property_location.sort()

                        var data_filterby_loc = new Array()
                        
                        //flag = 0 means open this website first time
                        if(flag==0){
                            var loc_filter = document.getElementById('location_feature')
                            for (i=0;i<unique_property_location.length;i++){
                                var loc_1 = document.createElement('li')

                                var loc_feature = document.createElement('input')
                                    loc_feature.type = "checkbox"
                                    loc_feature.value = unique_property_location[i]
                                    loc_feature.name = "myDistrict_CB"
                                    loc_feature.class = "filterby"
                                    loc_feature.id = "CB_Location"
                                    loc_feature.checked = false

                                var label = document.createElement('label')
                                    label.id = "CB_Location"
                                    

                                
                                label.appendChild(loc_feature)
                                label.appendChild(document.createTextNode(unique_property_location[i]))
                                loc_1.appendChild(label)
                                loc_filter.appendChild(loc_1) 
                            }                       
                        }else if(flag==1){
                            //var ul = document.getElementById("location_feature")
                            //var items = ul.getElementsByTagName("li")

                            var items = document.getElementsByName("myDistrict_CB")

                            for (i=0;i<items.length;i++){
                                if (items[i].checked == true){
                                    for(j=0;j<data_filterby_propertytype.length;j++){
                                        if(data_filterby_propertytype[j].position==items[i].value){
                                            data_filterby_loc.push(data_filterby_propertytype[j])
                                        }
                                    }
                                }
                            }
                        }

                        flag=1                  
                        data = data_filterby_loc

                        //console.log(data_RC_update)
                        var cluster_number = 4;

                    var data_input = JSON.parse(JSON.stringify(data))

                    //this will calculate zscore, perform PCA and use the first two PC dimension to do K-means
                    //the output will have three keys added to each object: pc1, pc2, and cluster, the output is ordered by clusters

                    // Perform kmeans only when num of data > 3 when group num = 3
                    if (data_input.length > 3) {
                                    data_w_cluster = kmeans(data_input, cluster_number);}
                                    else {
                                    data_w_cluster = data_input};

                    //console.log(data_w_cluster)    //Debug output

                    updateMap(data_w_cluster)

                    updateSortList(data_w_cluster, selectedGame)
                    })
                }


        // this function should sort data by selected feature
        function sortBySelectedFeature(data, selectedFeature){
                    //console.log(selectedFeature)
                    if(selectedFeature==="Default"){
                        return
                    }
                    else if(selectedFeature==="priceDescending"){
                        for (i=0;i<data.length;i++){
                            data_w_cluster.sort(function(a,b){
                                return (b.Price - a.Price)
                            })
                        }
                    }
                    else if(selectedFeature==="priceAscending"){
                        for (i=0;i<data.length;i++){
                            data_w_cluster.sort(function(a,b){
                                return (a.Price - b.Price)
                            })
                        }
                    }
                    else{
                        for (i=0;i<data.length;i++){
                            data_w_cluster.sort(function(a,b){
                                return (b.Rating - a.Rating)
                            })
                        }
                    }
                }

        // function to update Radar Chart
        function updateRC() {
                    svg_rc.selectAll("*").remove()

                    //svg_rc.call(radarChart)
                    //radarChart.options(radarChartOptions).update();

                    // Drop duplicated selections
                    var unique_data_RC = data_RC.filter(function(elem, pos){
                                            return data_RC.indexOf(elem) == pos;
                                        })

                    //console.log(unique_data_RC)
                    //console.log(RC_name_copy)

                    var data_RC_new = unique_data_RC.map(function(d)
                            {var features = new Array();
                            for (let i = 0; i <RC_name_copy.length; i++){
                              features.push({"axis":RC_name_copy[i], "value": d[RC_name_copy[i]]})
                              };
                            //console.log(d)
                            return {key: d.id.toString(),
                                  values: features}
                            })

                    svg_rc.call(radarChart)
                    //radarChart.options(radarChartOptions).update();

                    radarChart.options({'legend':{display : true}});
                    radarChart.data(data_RC_new).update();

                }


        // function to clear inputs for Radar Chart
        function clearRC() {
                    data_RC = new Array()
                    var data_RC_new = data_RC.map(function(d)
                            {var features = new Array();
                            for (let i = 0; i <RC_name_copy.length; i++){
                              features.push({"axis":RC_name_copy[i], "value": d[RC_name_copy[i]]})
                              };
                            return {key: d.id.toString(),
                                  values: features}
                            })
                    svg_rc.selectAll("*").remove()
                    svg_rc.call(radarChart)
                    radarChart.data(data_RC_new).update();
                  }


        // Function to update Map Interface
        function updateMap(input){
                    // For each row in data, create a marker and add it to the map
                    // For each row, columns `Latitude`, `Longitude`, and `Title` are required

                    // Clear Layer first for updates
                    markersLayer.clearLayers()

                    // Make copy of input data, preventing dynamic changing
                    var data_map = JSON.parse(JSON.stringify(input))

                    //console.log(data_map)

                    for (var i = 0; i < data_map.length; i++) {
                              //var row = data_map[i];

                              var row = data_map[i];

                              //console.log(i)
                              //console.log(data_map[i])

                              //console.log(row)

                              var row_ele = ' '

                              for (var j in RC_name) {
                                    if (RC_name[j] == "Price"){row_ele += RC_name[j] + ' - $' + row[RC_name[j]] + '<br>'
                                                        }
                                    else {row_ele += RC_name[j] + ' - ' + d3v5.format(".2f")(row[RC_name[j]]) + '<br>'}}

                              // Use one color if data points <4
                              var house_group = 0
                              if (data_map.length > 3){
                                  var house_group = parseInt(row.cluster)}

                              //console.log(row.id)
                              var marker = L.marker([row.Latitude, row.Longitude], {
                                opacity: 1,
                                icon: Icon_Color[house_group]
                              })



                              marker.myID = i;
                              marker.house_group = house_group
                              //console.log(marker)
                              marker.bindPopup("<b><br>ID " + row.id + " "+ row.Title +
                                                "</b><br><br>" + row_ele +
                                                "<br>" + row.Description, {maxWidth: 300, maxHeight: 150})
                              marker.on("click", function(d){
                                this.openPopup();
                                });

                              marker.on('dblclick', function(e) {var i = e.target.myID;
                                                              this.openPopup()

                                                              tempAlert("House " + data_map[i].id + " added to RadarChart", 3000)

                                                              //Push select data to Radar Chart
                                                              data_RC.push(data_map[i])
                                                              updateRC()
                                                              });

                              // Show popout via mouse hang-over
                              marker.on('mouseover', function(e) {
                                this.setIcon(big_Icon_Color[this.house_group])
                              })

                              marker.on('mouseout', function(e) {
                                this.setIcon(Icon_Color[this.house_group]);
                            })

                              markersLayer.addLayer(marker)

                            }

                    // Add Layer to map for updates
                    markersLayer.addTo(map)
                    }



        // Function to update sort list
        function updateSortList(input, input_feature){
                    // Sort List
                    sortBySelectedFeature(input, input_feature)

                    // Only showing top 200 sorted results
                    data = JSON.parse(JSON.stringify(input)).slice(0, 200)

                    svg_sl.selectAll("*").remove()
                    svg_bu.selectAll("*").remove()

                    //console.log(data)
                    var page_section = Math.floor(data.length/num_page)

                    //console.log(data.length)

                    var data_init = data.slice(0,num_page)

                    //console.log(data_init)


                    svg_sl.attr("height", 150 * data_init.length)

                    var slides = svg_sl.selectAll("image")
                            .data(data_init)

                    //console.log(page_section)

                    // Define range buttons

                    var buttons = svg_bu.selectAll("rect")
                            .data(d3.range(page_section))

                    buttons.enter()
                            .append('rect')
                            .attr("class", "button")
                            .attr('stroke', 'blue')
                            .attr('x', function(d, i){return button_width * i})
                            .attr('y', 0)
                            .attr("width", button_width)
                            .attr("height", button_height)
                            .attr('stroke-width', 2)
                            .attr('stroke', 'white')
                            .attr('fill', 'grey')
                            .style('stroke-width', 1)
                            .style("stroke",'grey')
                            .on('click', showList);

                    buttons.enter()
                            .append("text")
                            .attr("x", function(d, i){return button_width/2 + button_width * i })
                            .attr("y", button_height/2)
                            .attr("dy", ".35em")
                            .text(function(d){return d + 1})
                            .style("text-anchor", "middle")
                            .style("fill", "white")
                            .style("font-weight", 50)
                            .style("font-size", 20 * wlength/1920)
                            .on('click', showList);

                    // Default Presentation
                    var rect = slides.enter()
                            .append('rect')
                            .attr("class", "house_ele")
                            .attr('stroke', 'blue')
                            .attr('id', function (d) {return d.id})
                            .attr('x', 0)
                            .attr('y', function(d, i){return 150 * i})
                            .attr("width", 700 * wlength/1920)
                            .attr("height", 145)
                            .attr('stroke-width', 1)
                            .attr('stroke', 'grey')
                            .attr('fill', "#D7E2EA")
                            .on("click", function(d){
                                    d3.selectAll('rect').style("stroke",'grey')
                                    d3.selectAll('rect').style('stroke-width', 1)
                                    d3.select(this).style("stroke", 'red')
                                    d3.select(this).style('stroke-width',5)
                                    map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)})
                            .on("dblclick", function(d, i){
                                    tempAlert("House " + d.id + " added to RadarChart", 3000)
                                    data_RC.push(d)
                                    updateRC()
                                    //console.log(d)
                                    map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)
                                    });

                    var image = slides.enter()
                            .append('image')
                            .attr('x', 5)
                            .attr('y', function(d, i){return 10 + 150 * i})
                            .attr('width', 220* wlength/1920)
                            .attr('height', 140)
                            .attr("xlink:href", function(d){return d.image})
                            .on("click", function(d){
                                    d3.selectAll('rect').style("stroke",'grey')
                                    d3.selectAll('rect').style('stroke-width', 1)
                                    console.log(d)
                                    d3.select("rect[id='"+ d.id + "']").style("stroke", 'red')
                                    d3.select("rect[id='"+ d.id + "']").style('stroke-width',5)
                                    map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)})
                            .on("dblclick", function(d, i){
                                    tempAlert("House " + d.id + " added to RadarChart", 3000)
                                    data_RC.push(d)
                                    updateRC()
                                    //console.log(d)
                                    map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)
                                    });

                        var def = slides.enter()
                                        .append('defs')
                                        .append('clipPath')
                                        .attr('id', function(d, i){return "clip" + i})
                                        .append('rect')
                                        .attr('x', 5)
                                        .attr('y', function(d, i){return 150 * i})
                                        .attr('width', 220 * wlength/1920)
                                        .attr('height', 140)


                        // Apply Title to list board
                        slides.enter()
                                .append("text")
                                .attr("x", 230 * wlength/1920)
                                .attr("y", function(d, i){return 20 + 150 * i})
                                .attr("dy", ".35em")
                                .style("text-anchor", "left")
                                .text(function(d){return 'ID: ' + d.id + '  ' + d.Title.slice(0, 40)})
                                .on("click", function(d){
                                        d3.selectAll('rect').style("stroke",'grey')
                                        d3.selectAll('rect').style('stroke-width', 1)
                                        console.log(d)
                                        d3.select("rect[id='"+ d.id + "']").style("stroke", 'red')
                                        d3.select("rect[id='"+ d.id + "']").style('stroke-width',5)
                                        map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)})
                                .on("dblclick", function(d, i){
                                        tempAlert("House " + d.id + " added to RadarChart", 3000)
                                        data_RC.push(d)
                                        updateRC()
                                        //console.log(d)
                                        map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)
                                        });

                        for (j = 0; j < RC_name.length; j++){

                                slides.enter()
                                        .append("text")
                                        .attr("x", 230 * wlength/1920 + 160*(j%3) * wlength/1920)
                                        .attr("y", function(d, i){return 20*(Math.floor(j/3) + 2) + 150 * i})
                                        .attr("dy", ".35em")
                                        .style("text-anchor", "left")
                                        .text(function(d){return RC_name[j] + " : "+ d3v5.format(".2f")(d[RC_name[j]])})
                                        .on("click", function(d){
                                                d3.selectAll('rect').style("stroke",'grey')
                                                d3.selectAll('rect').style('stroke-width', 1)
                                                console.log(d)
                                                d3.select("rect[id='"+ d.id + "']").style("stroke", 'red')
                                                d3.select("rect[id='"+ d.id + "']").style('stroke-width',5)
                                                map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)})
                                        .on("dblclick", function(d, i){
                                                tempAlert("House " + d.id + " added to RadarChart", 3000)
                                                data_RC.push(d)
                                                updateRC()
                                                //console.log(d)
                                                map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)
                                                });
                        }


                        image.attr("clip-path", function(d, i){return "url(#clip" + i + ")"});

                        // Function to interactively show selected range
                        function showList(d){
                            //console.log("activate")
                            //console.log(d)

                            data_filter = data.slice(d*num_page,(d+1) * num_page)

                            //console.log(data_filter)

                            svg_sl.selectAll("*").remove()

                            svg_sl.attr("height", 150 * data_filter.length)

                            var slides_new = svg_sl.selectAll("image")
                                .data(data_filter)

                            var rect = slides_new.enter()
                                .append('rect')
                                .attr("class", "house_ele")
                                .attr('stroke', 'blue')
                                .attr('id', function (d) {return d.id})
                                .attr('x', 0)
                                .attr('y', function(d, i){return 150 * i})
                                .attr("width", 700 * wlength/1920)
                                .attr("height", 145)
                                .attr('stroke-width', 1)
                                .attr('stroke', 'grey')
                                .attr('fill', "#D7E2EA")
                                .on("click", function(d){
                                    d3.selectAll('rect').style("stroke",'grey')
                                    d3.selectAll('rect').style('stroke-width', 1)
                                    d3.select(this).style("stroke", 'red')
                                    d3.select(this).style('stroke-width',5)
                                    map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)})
                                .on("dblclick", function(d, i){
                                                tempAlert("House " + d.id + " added to RadarChart", 3000)
                                                data_RC.push(d)
                                                updateRC()
                                                //console.log(d)
                                                map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)
                                                });

                            var image = slides_new.enter()
                                              .append('image')
                                              .attr('x', 5)
                                              .attr('y', function(d, i){return 10 + 150 * i})
                                              .attr('width', 220 * wlength/1920)
                                              .attr('height', 140)
                                              .attr("xlink:href", function(d){return d.image})
                                              .on("click", function(d){
                                                    d3.selectAll('rect').style("stroke",'grey')
                                                    d3.selectAll('rect').style('stroke-width', 1)
                                                    console.log(d)
                                                    d3.select("rect[id='"+ d.id + "']").style("stroke", 'red')
                                                    d3.select("rect[id='"+ d.id + "']").style('stroke-width',5)
                                                    map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)})
                                              .on("dblclick", function(d, i){
                                                    tempAlert("House " + d.id + " added to RadarChart", 3000)
                                                    data_RC.push(d)
                                                    updateRC()
                                                    //console.log(d)
                                                    map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)
                                                    });

                            var def = slides_new.enter()
                                            .append('defs')
                                            .append('clipPath')
                                            .attr('id', function(d, i){return "clip" + i})
                                            .append('rect')
                                            .attr('x', 5)
                                            .attr('y', function(d, i){return 150 * i})
                                            .attr('width', 220* wlength/1920)
                                            .attr('height', 140);


                            // Apply Title to list board
                            slides_new.enter()
                                    .append("text")
                                    .attr("x", 230 * wlength/1920)
                                    .attr("y", function(d, i){return 20 + 150 * i})
                                    .attr("dy", ".35em")
                                    .style("text-anchor", "left")
                                    .text(function(d){return 'ID: ' + d.id + '  ' + d.Title.slice(0, 40)})
                                    .on("click", function(d){
                                            d3.selectAll('rect').style("stroke",'grey')
                                            d3.selectAll('rect').style('stroke-width', 1)
                                            console.log(d)
                                            d3.select("rect[id='"+ d.id + "']").style("stroke", 'red')
                                            d3.select("rect[id='"+ d.id + "']").style('stroke-width',5)
                                            map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)})
                                    .on("dblclick", function(d, i){
                                            tempAlert("House " + d.id + " added to RadarChart", 3000)
                                            data_RC.push(d)
                                            updateRC()
                                            //console.log(d)
                                            map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)
                                            });

                            // Apply Feature Scores to list board
                            for (j = 0; j < RC_name.length; j++){

                                    slides_new.enter()
                                            .append("text")
                                            .attr("x", 230* wlength/1920 + 160*(j%3)* wlength/1920)
                                            .attr("y", function(d, i){return 20*(Math.floor(j/3) + 2) + 150 * i})
                                            .attr("dy", ".35em")
                                            .style("text-anchor", "left")
                                            .text(function(d){return RC_name[j] + " : "+ d3v5.format(".2f")(d[RC_name[j]])})
                                            .on("click", function(d){
                                                d3.selectAll('rect').style("stroke",'grey')
                                                d3.selectAll('rect').style('stroke-width', 1)
                                                console.log(d)
                                                d3.select("rect[id='"+ d.id + "']").style("stroke", 'red')
                                                d3.select("rect[id='"+ d.id + "']").style('stroke-width',5)
                                                map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)})
                                            .on("dblclick", function(d, i){
                                                    tempAlert("House " + d.id + " added to RadarChart", 3000)
                                                    data_RC.push(d)
                                                    updateRC()
                                                    //console.log(d)
                                                    map.setView(new L.LatLng(d.Latitude, d.Longitude), 18)
                                                    });
                            }

                            image.attr("clip-path", function(d, i){return "url(#clip" + i + ")"});
                            };
                    }

                    // Popout message indicating points added to Radar Chart
                    function tempAlert(msg,duration)
                        {
                         var el = document.createElement("div");
                         el.setAttribute("style","position:absolute; top:40%; left:60%;  color: green; font-size: 0.8vw; font-weight: 600;");
                         el.innerHTML = msg;
                         setTimeout(function(){
                          el.parentNode.removeChild(el);
                         },duration);
                         document.body.appendChild(el);
                        }

                    //search box for checkboxes
                    $.expr[":"].contains = $.expr.createPseudo(function(arg) {
                                        return function( elem ) {
                                            return $(elem).text().toUpperCase().indexOf(arg.toUpperCase()) == 0;
                                        };
                                    });
                    function updateCheckboxes(x) {
                        
                          if ($('#SearchBar').val() == '') {
                            $('#location_feature > li > label').show();
                            
                          } else {
                            $('#location_feature > li > label').hide();

                            $('#location_feature > li > label:contains('+$('#SearchBar').val()+')').show();
                          }
                        }

    </Script>

</body>
</html>
